"use strict";(globalThis.webpackChunk_ohri_openmrs_esm_ohri_hiv_app=globalThis.webpackChunk_ohri_openmrs_esm_ohri_hiv_app||[]).push([[783],{783:(e,r,n)=>{n.r(r),n.d(r,{ProgramEnrollmentSubmissionAction:()=>c,default:()=>d});var t=n(2870),o=n(9734),i=n(3565),l=n.n(i);function a(e,r,n,t,o,i,l){try{var a=e[i](l),s=a.value}catch(e){return void n(e)}a.done?r(s):Promise.resolve(s).then(t,o)}var s,u,c={applyAction:(s=function(e,r){var n,i,a,s,u,c,d,p,m,f,h,v,b,g,w,P,y;return function(e,r){var n,t,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,t&&(o=2&i[0]?t.return:i[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,i[1])).done)return o;switch(t=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,t=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!((o=(o=l.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=r.call(e,l)}catch(e){i=[6,e],t=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,(function(E){switch(E.label){case 0:return n=e.patient,i=e.encounters,a=e.sessionMode,p=i[0],m=p.location.uuid,"view"===a?[2]:(f=null===(u=p.obs)||void 0===u||null===(s=u.find((function(e){return e.formFieldPath.includes(r.enrollmentDate)})))||void 0===s?void 0:s.value,h=null===(d=p.obs)||void 0===d||null===(c=d.find((function(e){return e.formFieldPath.includes(r.completionDate)})))||void 0===c?void 0:c.value,(v=r.programUuid)?(b=new AbortController,g={patient:n.id,program:v,dateEnrolled:f?l()(f).format():null,dateCompleted:h?l()(h).format():null,location:m},"enter"!==a?[3,2]:[4,(0,o.getPatientEnrolledPrograms)(n.id)]):[3,5]);case 1:if((w=E.sent())&&w.results.some((function(e){return e.program.uuid===v&&null===e.dateCompleted})))throw new Error("Cannot enroll patient to program. Patient already has an active enrollment");return(0,o.createProgramEnrollment)(g,b).subscribe((function(e){201===e.status&&(0,t.showToast)({critical:!0,kind:"success",description:"It is now visible in the Programs table",title:"Program enrollment saved"})}),(function(e){(0,t.showToast)({title:"Error saving program enrollment",kind:"error",critical:!1,description:null==e?void 0:e.message})})),[3,4];case 2:return[4,(0,o.getPatientEnrolledPrograms)(n.id)];case 3:P=E.sent(),y=null,P&&(y=P.results.find((function(e){return e.program.uuid===v&&null===e.dateCompleted}))),y&&(g.dateEnrolled||(g.dateEnrolled=y.dateEnrolled),(0,o.updateProgramEnrollment)(y.uuid,g,b).subscribe((function(e){200===e.status&&(0,t.showToast)({critical:!0,kind:"success",description:"Changes to the program are now visible in the Programs table",title:"Program enrollment updated"})}),(function(e){(0,t.showToast)({title:"Error saving enrollment",kind:"error",critical:!1,description:null==e?void 0:e.message})}))),E.label=4;case 4:return[3,6];case 5:throw new Error("Please provide Program Uuid to enroll patient to.");case 6:return[2]}}))},u=function(){var e=this,r=arguments;return new Promise((function(n,t){var o=s.apply(e,r);function i(e){a(o,n,t,i,l,"next",e)}function l(e){a(o,n,t,i,l,"throw",e)}i(void 0)}))},function(e,r){return u.apply(this,arguments)})};const d=c}}]);